(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
class Cell extends ex.Actor {
    constructor(x, y, color) {
        super(x * Cell.size, y * Cell.size, Cell.size, Cell.size, color);
    }
}
Cell.size = 40;
class Wall extends Cell {
    constructor(x, y) { super(x, y, ex.Color.Gray); }
}
class Holder extends Cell {
    constructor(x, y) { super(x, y, ex.Color.Black); }
}
class Box extends Cell {
    constructor(x, y) { super(x, y, ex.Color.Orange); }
}
class Player extends Cell {
    constructor(level, gridX, gridY) {
        super(gridX, gridY, ex.Color.White);
        this.gridX = gridX;
        this.gridY = gridY;
        this.level = level;
    }
    onInitialize(engine) {
        this.setZIndex(1);
    }
    update(engine, delta) {
        super.update(engine, delta);
        if (engine.input.keyboard.wasPressed(ex.Input.Keys.W) || engine.input.keyboard.wasPressed(ex.Input.Keys.Up)) {
            this.moveBy(0, -1);
        }
        if (engine.input.keyboard.wasPressed(ex.Input.Keys.S) || engine.input.keyboard.wasPressed(ex.Input.Keys.Down)) {
            this.moveBy(0, 1);
        }
        if (engine.input.keyboard.wasPressed(ex.Input.Keys.D) || engine.input.keyboard.wasPressed(ex.Input.Keys.Right)) {
            this.moveBy(1, 0);
        }
        if (engine.input.keyboard.wasPressed(ex.Input.Keys.A) || engine.input.keyboard.wasPressed(ex.Input.Keys.Left)) {
            this.moveBy(-1, 0);
        }
    }
    moveBy(dx, dy) {
        let cell = this.level.grid[this.gridY + dy][this.gridX + dx];
        const delta = new ex.Vector(dx, dy).scale(Cell.size);
        if (cell instanceof Wall) {
            return;
        }
        if (cell instanceof Box) {
            let nextCell = this.level.grid[this.gridY + 2 * dy][this.gridX + 2 * dx];
            if (nextCell === undefined) {
                cell.pos = cell.pos.add(delta);
                this.level.grid[this.gridY + dy][this.gridX + dx] = undefined;
                this.level.grid[this.gridY + 2 * dy][this.gridX + 2 * dx] = cell;
            }
            else if (nextCell instanceof Holder) {
                this.level.grid[this.gridY + dy][this.gridX + dx] = undefined;
                this.level.grid[this.gridY + 2 * dy][this.gridX + 2 * dx] = undefined;
                cell.kill();
                nextCell.kill();
                this.level.closeHole();
            }
            else {
                return;
            }
        }
        this.gridX += dx;
        this.gridY += dy;
        this.pos = this.pos.add(delta);
    }
}
class Level extends ex.Scene {
    constructor(level) {
        super();
        this.holes = 0;
        this.rawLevel = level;
    }
    onInitialize(engine) {
        // TODO: Count x as the longest row's length.
        this.size = new ex.Vector(this.rawLevel[0].length, this.rawLevel.length);
        this.grid = new Array();
        for (let i = 0; i < this.size.y; i++) {
            this.grid[i] = new Array(this.size.x);
            for (let j = 0; j < this.size.x; j++) {
                let cell = undefined;
                switch (this.rawLevel[i][j]) {
                    case "#":
                        cell = new Wall(j, i);
                        break;
                    case "0":
                        cell = new Box(j, i);
                        break;
                    case ".":
                        cell = new Holder(j, i);
                        this.holes += 1;
                        break;
                    case "@":
                        this.player = new Player(this, j, i);
                        // Player is not a part of a grid.
                        this.add(this.player);
                        break;
                }
                if (cell) {
                    this.add(cell);
                    this.grid[i][j] = cell;
                }
            }
        }
        let camera = new ex.LockedCamera();
        const widthFactor = engine.getDrawWidth() / this.size.x;
        const heightFactor = engine.getDrawHeight() / this.size.y;
        // camera.zoom(Math.floor(Math.min(widthFactor, heightFactor) / Cell.size) || 1);
        camera.zoom(Math.min(widthFactor, heightFactor) / Cell.size);
        camera.move(new ex.Vector(this.size.x * Cell.size / 2 - Cell.size / 2, this.size.y * Cell.size / 2 - Cell.size / 2), 0);
        this.camera = camera;
    }
    closeHole() {
        this.holes -= 1;
        if (this.holes === 0) {
            alert("You won!");
        }
    }
}
const simpleLevel = [
    "  ######",
    "  # ..@#",
    "  # 00 #",
    "  ## ###",
    "   # #  ",
    "   # #  ",
    "#### #  ",
    "#    ## ",
    "# #   # ",
    "#   # # ",
    "###   # ",
    "  ##### "
];
const level1a = [
    "######## ######",
    "# #@   ###    #",
    "#.## 00    0  #",
    "#.##  00# 0 0 #",
    "#.##    #     #",
    "#.#######0#####",
    "#.#    #      #",
    "#.######      #",
    "#  ....0000   #",
    "#  #####      #",
    "####   ########"
];
const level1b = [
    "######  ##### ",
    "#    #  #   # ",
    "# 0  #### 0 # ",
    "# 0      0  # ",
    "#  ###@###0 # ",
    "########## ###",
    "#  ... #     #",
    "#  #####0    #",
    "##.#   # 0   #",
    " #.##### 0   #",
    " #  ....0 0  #",
    " #  ##########",
    " ####         "
];
const level2a = [
    " ####                    ",
    "## @########             ",
    "#          #             ",
    "# 0#####0# #             ",
    "#  #   # 0 #             ",
    "# 0 0    0##             ",
    "# 0  0  #  #             ",
    "# ####0 ## #             ",
    "#  0   0 # ##            ",
    "# ###0#   0 #############",
    "#   #  0# 0 ............#",
    "#  0      ###############",
    "#####  #  #              ",
    "    #######              "
];
const level2b = [
    "###########                 ",
    "#    #    ###               ",
    "#  00#00   @#               ",
    "#     0   ###               ",
    "#    #    #                 ",
    "## #########                ",
    "#  0 #     #                ",
    "# 00 #0 0 0#                ",
    "#  0     0 #                ",
    "# 000#0  0 #################",
    "#    #  0 0 ...............#",
    "############################"
];
const level3a = [
    "  ########         ",
    "### #    #         ",
    "#   0    ###       ",
    "# # 00#00# #       ",
    "# 00#      #       ",
    "# #  0 #   #       ",
    "#    #0##0##       ",
    "#  00  0   #       ",
    "# ##   #   #       ",
    "#    #0#####       ",
    "###  0 ############",
    "  #  0@...........#",
    "  #################"
];
const level3b = [
    "##############     ",
    "#        #   #     ",
    "# 00  #00# # #     ",
    "#  # 0 0 #00 #     ",
    "## #  #  # # #     ",
    "#   ##       #     ",
    "#   # 0 #   ##     ",
    "# 0 #0 #   ###     ",
    "##0 #  ############",
    "#  0    ..........#",
    "#   # @############",
    "########           "
];
const level4a = [
    "#########################",
    "#@      ................#",
    "#       #################",
    "####### ######           ",
    " #           #           ",
    " # 0 0 0 0 0 #           ",
    "######## #####           ",
    "#   0 0  0 0 #           ",
    "#   0        #           ",
    "##### ########           ",
    " #  0 0 0   #            ",
    " #     0    #            ",
    " # 0 0   0 ##            ",
    "####### ####             ",
    "#  0     #               ",
    "#        #               ",
    "#   ######               ",
    "#####                    "
];
const level4b = [
    "  #############",
    "  #  .........#",
    "  #  .........#",
    "  #  ##########",
    "#### #    #####",
    "#  #0##  ##   #",
    "#     #### 0  #",
    "# 00  #  #  0 #",
    "##  00#   00 ##",
    " #0  0   #0  # ",
    " # 00 #  #  0# ",
    " # 0 0#### 0 # ",
    " #       #  ## ",
    " #### 0  # ##  ",
    "    ### ## #   ",
    "     # 0   #   ",
    "     #@ #  #   ",
    "     #######   "
];
let game = new ex.Engine({
    displayMode: ex.DisplayMode.FullScreen
});
// game.addScene("level1b", new Level(simpleLevel));
// game.addScene("level1b", new Level(level1b));
game.setAntialiasing(false);
game.addScene("level1b", new Level(level1b));
game.goToScene("level1b");
game.start();
const movePlayerBy = function (dx, dy) {
    if (game.currentScene instanceof Level) {
        game.currentScene.player.moveBy(dx, dy);
    }
};
["click", "touchstart"].forEach(function (action) {
    document.getElementById("control-left").addEventListener(action, function (event) {
        event.preventDefault();
        movePlayerBy(-1, 0);
    });
    document.getElementById("control-up").addEventListener(action, function (event) {
        event.preventDefault();
        movePlayerBy(0, -1);
    });
    document.getElementById("control-down").addEventListener(action, function (event) {
        event.preventDefault();
        movePlayerBy(0, 1);
    });
    document.getElementById("control-right").addEventListener(action, function (event) {
        event.preventDefault();
        movePlayerBy(1, 0);
    });
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsVUFBb0IsU0FBUSxFQUFFLENBQUMsS0FBSztJQUdsQyxZQUFZLENBQVMsRUFBRSxDQUFTLEVBQUUsS0FBZTtRQUMvQyxLQUFLLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ25FLENBQUM7O0FBSmUsU0FBSSxHQUFXLEVBQUUsQ0FBQztBQU9wQyxVQUFXLFNBQVEsSUFBSTtJQUNyQixZQUFZLENBQVMsRUFBRSxDQUFTLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Q0FDbEU7QUFFRCxZQUFhLFNBQVEsSUFBSTtJQUN2QixZQUFZLENBQVMsRUFBRSxDQUFTLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Q0FDbkU7QUFFRCxTQUFVLFNBQVEsSUFBSTtJQUNwQixZQUFZLENBQVMsRUFBRSxDQUFTLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Q0FDcEU7QUFFRCxZQUFhLFNBQVEsSUFBSTtJQUd2QixZQUFZLEtBQVksRUFBVSxLQUFhLEVBQVUsS0FBYTtRQUNwRSxLQUFLLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBREosVUFBSyxHQUFMLEtBQUssQ0FBUTtRQUFVLFVBQUssR0FBTCxLQUFLLENBQVE7UUFHcEUsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDckIsQ0FBQztJQUVNLFlBQVksQ0FBQyxNQUFpQjtRQUNuQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFFTSxNQUFNLENBQUMsTUFBaUIsRUFBRSxLQUFhO1FBQzVDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRTVCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckIsQ0FBQztRQUVELEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLENBQUM7UUFFRCxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNwQixDQUFDO1FBRUQsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNyQixDQUFDO0lBQ0gsQ0FBQztJQUVNLE1BQU0sQ0FBQyxFQUFVLEVBQUUsRUFBVTtRQUNsQyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDN0QsTUFBTSxLQUFLLEdBQUcsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXJELEVBQUUsQ0FBQyxDQUFDLElBQUksWUFBWSxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLE1BQU0sQ0FBQztRQUNULENBQUM7UUFFRCxFQUFFLENBQUMsQ0FBQyxJQUFJLFlBQVksR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN4QixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxF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QyxDQUFDO0lBQ3JCLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiYWJzdHJhY3QgY2xhc3MgQ2VsbCBleHRlbmRzIGV4LkFjdG9yIHtcbiAgc3RhdGljIHJlYWRvbmx5IHNpemU6IG51bWJlciA9IDQwO1xuXG4gIGNvbnN0cnVjdG9yKHg6IG51bWJlciwgeTogbnVtYmVyLCBjb2xvcjogZXguQ29sb3IpIHtcbiAgICBzdXBlcih4ICogQ2VsbC5zaXplLCB5ICogQ2VsbC5zaXplLCBDZWxsLnNpemUsIENlbGwuc2l6ZSwgY29sb3IpO1xuICB9XG59XG5cbmNsYXNzIFdhbGwgZXh0ZW5kcyBDZWxsIHtcbiAgY29uc3RydWN0b3IoeDogbnVtYmVyLCB5OiBudW1iZXIpIHsgc3VwZXIoeCwgeSwgZXguQ29sb3IuR3JheSk7IH1cbn1cblxuY2xhc3MgSG9sZGVyIGV4dGVuZHMgQ2VsbCB7XG4gIGNvbnN0cnVjdG9yKHg6IG51bWJlciwgeTogbnVtYmVyKSB7IHN1cGVyKHgsIHksIGV4LkNvbG9yLkJsYWNrKTsgfVxufVxuXG5jbGFzcyBCb3ggZXh0ZW5kcyBDZWxsIHtcbiAgY29uc3RydWN0b3IoeDogbnVtYmVyLCB5OiBudW1iZXIpIHsgc3VwZXIoeCwgeSwgZXguQ29sb3IuT3JhbmdlKTsgfVxufVxuXG5jbGFzcyBQbGF5ZXIgZXh0ZW5kcyBDZWxsIHtcbiAgcHJpdmF0ZSBsZXZlbDogTGV2ZWw7XG5cbiAgY29uc3RydWN0b3IobGV2ZWw6IExldmVsLCBwcml2YXRlIGdyaWRYOiBudW1iZXIsIHByaXZhdGUgZ3JpZFk6IG51bWJlcikge1xuICAgIHN1cGVyKGdyaWRYLCBncmlkWSwgZXguQ29sb3IuV2hpdGUpO1xuXG4gICAgdGhpcy5sZXZlbCA9IGxldmVsO1xuICB9XG5cbiAgcHVibGljIG9uSW5pdGlhbGl6ZShlbmdpbmU6IGV4LkVuZ2luZSkge1xuICAgIHRoaXMuc2V0WkluZGV4KDEpO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZShlbmdpbmU6IGV4LkVuZ2luZSwgZGVsdGE6IG51bWJlcikge1xuICAgIHN1cGVyLnVwZGF0ZShlbmdpbmUsIGRlbHRhKTtcblxuICAgIGlmIChlbmdpbmUuaW5wdXQua2V5Ym9hcmQud2FzUHJlc3NlZChleC5JbnB1dC5LZXlzLlcpIHx8IGVuZ2luZS5pbnB1dC5rZXlib2FyZC53YXNQcmVzc2VkKGV4LklucHV0LktleXMuVXApKSB7XG4gICAgICB0aGlzLm1vdmVCeSgwLCAtMSk7XG4gICAgfVxuXG4gICAgaWYgKGVuZ2luZS5pbnB1dC5rZXlib2FyZC53YXNQcmVzc2VkKGV4LklucHV0LktleXMuUykgfHwgZW5naW5lLmlucHV0LmtleWJvYXJkLndhc1ByZXNzZWQoZXguSW5wdXQuS2V5cy5Eb3duKSkge1xuICAgICAgdGhpcy5tb3ZlQnkoMCwgMSk7XG4gICAgfVxuXG4gICAgaWYgKGVuZ2luZS5pbnB1dC5rZXlib2FyZC53YXNQcmVzc2VkKGV4LklucHV0LktleXMuRCkgfHwgZW5naW5lLmlucHV0LmtleWJvYXJkLndhc1ByZXNzZWQoZXguSW5wdXQuS2V5cy5SaWdodCkpIHtcbiAgICAgIHRoaXMubW92ZUJ5KDEsIDApO1xuICAgIH1cblxuICAgIGlmIChlbmdpbmUuaW5wdXQua2V5Ym9hcmQud2FzUHJlc3NlZChleC5JbnB1dC5LZXlzLkEpIHx8IGVuZ2luZS5pbnB1dC5rZXlib2FyZC53YXNQcmVzc2VkKGV4LklucHV0LktleXMuTGVmdCkpIHtcbiAgICAgIHRoaXMubW92ZUJ5KC0xLCAwKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgbW92ZUJ5KGR4OiBudW1iZXIsIGR5OiBudW1iZXIpOiB2b2lkIHtcbiAgICBsZXQgY2VsbCA9IHRoaXMubGV2ZWwuZ3JpZFt0aGlzLmdyaWRZICsgZHldW3RoaXMuZ3JpZFggKyBkeF07XG4gICAgY29uc3QgZGVsdGEgPSBuZXcgZXguVmVjdG9yKGR4LCBkeSkuc2NhbGUoQ2VsbC5zaXplKTtcblxuICAgIGlmIChjZWxsIGluc3RhbmNlb2YgV2FsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChjZWxsIGluc3RhbmNlb2YgQm94KSB7XG4gICAgICBsZXQgbmV4dENlbGwgPSB0aGlzLmxldmVsLmdyaWRbdGhpcy5ncmlkWSArIDIgKiBkeV1bdGhpcy5ncmlkWCArIDIgKiBkeF07XG4gICAgICBpZiAobmV4dENlbGwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjZWxsLnBvcyA9IGNlbGwucG9zLmFkZChkZWx0YSk7XG4gICAgICAgIHRoaXMubGV2ZWwuZ3JpZFt0aGlzLmdyaWRZICsgZHldW3RoaXMuZ3JpZFggKyBkeF0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGV2ZWwuZ3JpZFt0aGlzLmdyaWRZICsgMiAqIGR5XVt0aGlzLmdyaWRYICsgMiAqIGR4XSA9IGNlbGw7XG5cbiAgICAgIH0gZWxzZSBpZiAobmV4dENlbGwgaW5zdGFuY2VvZiBIb2xkZXIpIHtcbiAgICAgICAgdGhpcy5sZXZlbC5ncmlkW3RoaXMuZ3JpZFkgKyBkeV1bdGhpcy5ncmlkWCArIGR4XSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sZXZlbC5ncmlkW3RoaXMuZ3JpZFkgKyAyICogZHldW3RoaXMuZ3JpZFggKyAyICogZHhdID0gdW5kZWZpbmVkO1xuICAgICAgICBjZWxsLmtpbGwoKTtcbiAgICAgICAgbmV4dENlbGwua2lsbCgpO1xuICAgICAgICB0aGlzLmxldmVsLmNsb3NlSG9sZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZ3JpZFggKz0gZHg7XG4gICAgdGhpcy5ncmlkWSArPSBkeTtcbiAgICB0aGlzLnBvcyA9IHRoaXMucG9zLmFkZChkZWx0YSk7XG4gIH1cbn1cblxuY2xhc3MgTGV2ZWwgZXh0ZW5kcyBleC5TY2VuZSB7XG4gIHB1YmxpYyBwbGF5ZXI6IFBsYXllcjtcbiAgcHVibGljIGdyaWQ6IEFycmF5PEFycmF5PENlbGw+PjtcblxuICBwcml2YXRlIHJhd0xldmVsOiBBcnJheTxzdHJpbmc+O1xuXG4gIHByaXZhdGUgaG9sZXM6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgc2l6ZTogZXguVmVjdG9yO1xuXG4gIGNvbnN0cnVjdG9yKGxldmVsOiBBcnJheTxzdHJpbmc+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnJhd0xldmVsID0gbGV2ZWw7XG4gIH1cblxuICBwdWJsaWMgb25Jbml0aWFsaXplKGVuZ2luZTogZXguRW5naW5lKSB7XG4gICAgLy8gVE9ETzogQ291bnQgeCBhcyB0aGUgbG9uZ2VzdCByb3cncyBsZW5ndGguXG4gICAgdGhpcy5zaXplID0gbmV3IGV4LlZlY3Rvcih0aGlzLnJhd0xldmVsWzBdLmxlbmd0aCwgdGhpcy5yYXdMZXZlbC5sZW5ndGgpO1xuICAgIHRoaXMuZ3JpZCA9IG5ldyBBcnJheSgpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNpemUueTsgaSsrKSB7XG4gICAgICB0aGlzLmdyaWRbaV0gPSBuZXcgQXJyYXkodGhpcy5zaXplLngpO1xuXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2l6ZS54OyBqKyspIHtcbiAgICAgICAgbGV0IGNlbGw6IENlbGwgPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgc3dpdGNoICh0aGlzLnJhd0xldmVsW2ldW2pdKSB7XG4gICAgICAgICAgY2FzZSBcIiNcIjpcbiAgICAgICAgICAgIGNlbGwgPSBuZXcgV2FsbChqLCBpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCIwXCI6XG4gICAgICAgICAgICBjZWxsID0gbmV3IEJveChqLCBpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCIuXCI6XG4gICAgICAgICAgICBjZWxsID0gbmV3IEhvbGRlcihqLCBpKTtcbiAgICAgICAgICAgIHRoaXMuaG9sZXMgKz0gMTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJAXCI6XG4gICAgICAgICAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXIodGhpcywgaiwgaSk7XG4gICAgICAgICAgICAvLyBQbGF5ZXIgaXMgbm90IGEgcGFydCBvZiBhIGdyaWQuXG4gICAgICAgICAgICB0aGlzLmFkZCh0aGlzLnBsYXllcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjZWxsKSB7XG4gICAgICAgICAgdGhpcy5hZGQoY2VsbCk7XG4gICAgICAgICAgdGhpcy5ncmlkW2ldW2pdID0gY2VsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBjYW1lcmEgPSBuZXcgZXguTG9ja2VkQ2FtZXJhKCk7XG5cbiAgICBjb25zdCB3aWR0aEZhY3RvciA9IGVuZ2luZS5nZXREcmF3V2lkdGgoKSAvIHRoaXMuc2l6ZS54O1xuICAgIGNvbnN0IGhlaWdodEZhY3RvciA9IGVuZ2luZS5nZXREcmF3SGVpZ2h0KCkgLyB0aGlzLnNpemUueTtcblxuICAgIC8vIGNhbWVyYS56b29tKE1hdGguZmxvb3IoTWF0aC5taW4od2lkdGhGYWN0b3IsIGhlaWdodEZhY3RvcikgLyBDZWxsLnNpemUpIHx8IDEpO1xuICAgIGNhbWVyYS56b29tKE1hdGgubWluKHdpZHRoRmFjdG9yLCBoZWlnaHRGYWN0b3IpIC8gQ2VsbC5zaXplKTtcblxuICAgIGNhbWVyYS5tb3ZlKFxuICAgICAgbmV3IGV4LlZlY3RvcihcbiAgICAgICAgdGhpcy5zaXplLnggKiBDZWxsLnNpemUgLyAyIC0gQ2VsbC5zaXplIC8gMixcbiAgICAgICAgdGhpcy5zaXplLnkgKiBDZWxsLnNpemUgLyAyIC0gQ2VsbC5zaXplIC8gMlxuICAgICAgKSxcbiAgICAgIDBcbiAgICApO1xuXG4gICAgdGhpcy5jYW1lcmEgPSBjYW1lcmE7XG4gIH1cblxuICBwdWJsaWMgY2xvc2VIb2xlKCk6IHZvaWQge1xuICAgIHRoaXMuaG9sZXMgLT0gMTtcbiAgICBpZiAodGhpcy5ob2xlcyA9PT0gMCkge1xuICAgICAgYWxlcnQoXCJZb3Ugd29uIVwiKTtcbiAgICB9XG4gIH1cbn1cblxuY29uc3Qgc2ltcGxlTGV2ZWwgPSBbXG4gIFwiICAjIyMjIyNcIixcbiAgXCIgICMgLi5AI1wiLFxuICBcIiAgIyAwMCAjXCIsXG4gIFwiICAjIyAjIyNcIixcbiAgXCIgICAjICMgIFwiLFxuICBcIiAgICMgIyAgXCIsXG4gIFwiIyMjIyAjICBcIixcbiAgXCIjICAgICMjIFwiLFxuICBcIiMgIyAgICMgXCIsXG4gIFwiIyAgICMgIyBcIixcbiAgXCIjIyMgICAjIFwiLFxuICBcIiAgIyMjIyMgXCJcbl07XG5cbmNvbnN0IGxldmVsMWEgPSBbXG4gIFwiIyMjIyMjIyMgIyMjIyMjXCIsXG4gIFwiIyAjQCAgICMjIyAgICAjXCIsXG4gIFwiIy4jIyAwMCAgICAwICAjXCIsXG4gIFwiIy4jIyAgMDAjIDAgMCAjXCIsXG4gIFwiIy4jIyAgICAjICAgICAjXCIsXG4gIFwiIy4jIyMjIyMjMCMjIyMjXCIsXG4gIFwiIy4jICAgICMgICAgICAjXCIsXG4gIFwiIy4jIyMjIyMgICAgICAjXCIsXG4gIFwiIyAgLi4uLjAwMDAgICAjXCIsXG4gIFwiIyAgIyMjIyMgICAgICAjXCIsXG4gIFwiIyMjIyAgICMjIyMjIyMjXCJcbl07XG5cbmNvbnN0IGxldmVsMWIgPSBbXG4gIFwiIyMjIyMjICAjIyMjIyBcIixcbiAgXCIjICAgICMgICMgICAjIFwiLFxuICBcIiMgMCAgIyMjIyAwICMgXCIsXG4gIFwiIyAwICAgICAgMCAgIyBcIixcbiAgXCIjICAjIyNAIyMjMCAjIFwiLFxuICBcIiMjIyMjIyMjIyMgIyMjXCIsXG4gIFwiIyAgLi4uICMgICAgICNcIixcbiAgXCIjICAjIyMjIzAgICAgI1wiLFxuICBcIiMjLiMgICAjIDAgICAjXCIsXG4gIFwiICMuIyMjIyMgMCAgICNcIixcbiAgXCIgIyAgLi4uLjAgMCAgI1wiLFxuICBcIiAjICAjIyMjIyMjIyMjXCIsXG4gIFwiICMjIyMgICAgICAgICBcIlxuXTtcblxuY29uc3QgbGV2ZWwyYSA9IFtcbiAgXCIgIyMjIyAgICAgICAgICAgICAgICAgICAgXCIsXG4gIFwiIyMgQCMjIyMjIyMjICAgICAgICAgICAgIFwiLFxuICBcIiMgICAgICAgICAgIyAgICAgICAgICAgICBcIixcbiAgXCIjIDAjIyMjIzAjICMgICAgICAgICAgICAgXCIsXG4gIFwiIyAgIyAgICMgMCAjICAgICAgICAgICAgIFwiLFxuICBcIiMgMCAwICAgIDAjIyAgICAgICAgICAgICBcIixcbiAgXCIjIDAgIDAgICMgICMgICAgICAgICAgICAgXCIsXG4gIFwiIyAjIyMjMCAjIyAjICAgICAgICAgICAgIFwiLFxuICBcIiMgIDAgICAwICMgIyMgICAgICAgICAgICBcIixcbiAgXCIjICMjIzAjICAgMCAjIyMjIyMjIyMjIyMjXCIsXG4gIFwiIyAgICMgIDAjIDAgLi4uLi4uLi4uLi4uI1wiLFxuICBcIiMgIDAgICAgICAjIyMjIyMjIyMjIyMjIyNcIixcbiAgXCIjIyMjIyAgIyAgIyAgICAgICAgICAgICAgXCIsXG4gIFwiICAgICMjIyMjIyMgICAgICAgICAgICAgIFwiXG5dO1xuXG5jb25zdCBsZXZlbDJiID0gW1xuICBcIiMjIyMjIyMjIyMjICAgICAgICAgICAgICAgICBcIixcbiAgXCIjICAgICMgICAgIyMjICAgICAgICAgICAgICAgXCIsXG4gIFwiIyAgMDAjMDAgICBAIyAgICAgICAgICAgICAgIFwiLFxuICBcIiMgICAgIDAgICAjIyMgICAgICAgICAgICAgICBcIixcbiAgXCIjICAgICMgICAgIyAgICAgICAgICAgICAgICAgXCIsXG4gIFwiIyMgIyMjIyMjIyMjICAgICAgICAgICAgICAgIFwiLFxuICBcIiMgIDAgIyAgICAgIyAgICAgICAgICAgICAgICBcIixcbiAgXCIjIDAwICMwIDAgMCMgICAgICAgICAgICAgICAgXCIsXG4gIFwiIyAgMCAgICAgMCAjICAgICAgICAgICAgICAgIFwiLFxuICBcIiMgMDAwIzAgIDAgIyMjIyMjIyMjIyMjIyMjIyNcIixcbiAgXCIjICAgICMgIDAgMCAuLi4uLi4uLi4uLi4uLi4jXCIsXG4gIFwiIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1wiXG5dO1xuXG5jb25zdCBsZXZlbDNhID0gW1xuICBcIiAgIyMjIyMjIyMgICAgICAgICBcIixcbiAgXCIjIyMgIyAgICAjICAgICAgICAgXCIsXG4gIFwiIyAgIDAgICAgIyMjICAgICAgIFwiLFxuICBcIiMgIyAwMCMwMCMgIyAgICAgICBcIixcbiAgXCIjIDAwIyAgICAgICMgICAgICAgXCIsXG4gIFwiIyAjICAwICMgICAjICAgICAgIFwiLFxuICBcIiMgICAgIzAjIzAjIyAgICAgICBcIixcbiAgXCIjICAwMCAgMCAgICMgICAgICAgXCIsXG4gIFwiIyAjIyAgICMgICAjICAgICAgIFwiLFxuICBcIiMgICAgIzAjIyMjIyAgICAgICBcIixcbiAgXCIjIyMgIDAgIyMjIyMjIyMjIyMjXCIsXG4gIFwiICAjICAwQC4uLi4uLi4uLi4uI1wiLFxuICBcIiAgIyMjIyMjIyMjIyMjIyMjIyNcIlxuXTtcblxuY29uc3QgbGV2ZWwzYiA9IFtcbiAgXCIjIyMjIyMjIyMjIyMjIyAgICAgXCIsXG4gIFwiIyAgICAgICAgIyAgICMgICAgIFwiLFxuICBcIiMgMDAgICMwMCMgIyAjICAgICBcIixcbiAgXCIjICAjIDAgMCAjMDAgIyAgICAgXCIsXG4gIFwiIyMgIyAgIyAgIyAjICMgICAgIFwiLFxuICBcIiMgICAjIyAgICAgICAjICAgICBcIixcbiAgXCIjICAgIyAwICMgICAjIyAgICAgXCIsXG4gIFwiIyAwICMwICMgICAjIyMgICAgIFwiLFxuICBcIiMjMCAjICAjIyMjIyMjIyMjIyNcIixcbiAgXCIjICAwICAgIC4uLi4uLi4uLi4jXCIsXG4gIFwiIyAgICMgQCMjIyMjIyMjIyMjI1wiLFxuICBcIiMjIyMjIyMjICAgICAgICAgICBcIlxuXTtcblxuY29uc3QgbGV2ZWw0YSA9IFtcbiAgXCIjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXCIsXG4gIFwiI0AgICAgICAuLi4uLi4uLi4uLi4uLi4uI1wiLFxuICBcIiMgICAgICAgIyMjIyMjIyMjIyMjIyMjIyNcIixcbiAgXCIjIyMjIyMjICMjIyMjIyAgICAgICAgICAgXCIsXG4gIFwiICMgICAgICAgICAgICMgICAgICAgICAgIFwiLFxuICBcIiAjIDAgMCAwIDAgMCAjICAgICAgICAgICBcIixcbiAgXCIjIyMjIyMjIyAjIyMjIyAgICAgICAgICAgXCIsXG4gIFwiIyAgIDAgMCAgMCAwICMgICAgICAgICAgIFwiLFxuICBcIiMgICAwICAgICAgICAjICAgICAgICAgICBcIixcbiAgXCIjIyMjIyAjIyMjIyMjIyAgICAgICAgICAgXCIsXG4gIFwiICMgIDAgMCAwICAgIyAgICAgICAgICAgIFwiLFxuICBcIiAjICAgICAwICAgICMgICAgICAgICAgICBcIixcbiAgXCIgIyAwIDAgICAwICMjICAgICAgICAgICAgXCIsXG4gIFwiIyMjIyMjIyAjIyMjICAgICAgICAgICAgIFwiLFxuICBcIiMgIDAgICAgICMgICAgICAgICAgICAgICBcIixcbiAgXCIjICAgICAgICAjICAgICAgICAgICAgICAgXCIsXG4gIFwiIyAgICMjIyMjIyAgICAgICAgICAgICAgIFwiLFxuICBcIiMjIyMjICAgICAgICAgICAgICAgICAgICBcIlxuXTtcblxuY29uc3QgbGV2ZWw0YiA9IFtcbiAgXCIgICMjIyMjIyMjIyMjIyNcIixcbiAgXCIgICMgIC4uLi4uLi4uLiNcIixcbiAgXCIgICMgIC4uLi4uLi4uLiNcIixcbiAgXCIgICMgICMjIyMjIyMjIyNcIixcbiAgXCIjIyMjICMgICAgIyMjIyNcIixcbiAgXCIjICAjMCMjICAjIyAgICNcIixcbiAgXCIjICAgICAjIyMjIDAgICNcIixcbiAgXCIjIDAwICAjICAjICAwICNcIixcbiAgXCIjIyAgMDAjICAgMDAgIyNcIixcbiAgXCIgIzAgIDAgICAjMCAgIyBcIixcbiAgXCIgIyAwMCAjICAjICAwIyBcIixcbiAgXCIgIyAwIDAjIyMjIDAgIyBcIixcbiAgXCIgIyAgICAgICAjICAjIyBcIixcbiAgXCIgIyMjIyAwICAjICMjICBcIixcbiAgXCIgICAgIyMjICMjICMgICBcIixcbiAgXCIgICAgICMgMCAgICMgICBcIixcbiAgXCIgICAgICNAICMgICMgICBcIixcbiAgXCIgICAgICMjIyMjIyMgICBcIlxuXTtcblxubGV0IGdhbWUgPSBuZXcgZXguRW5naW5lKHtcbiAgZGlzcGxheU1vZGU6IGV4LkRpc3BsYXlNb2RlLkZ1bGxTY3JlZW5cbn0pO1xuXG5cbi8vIGdhbWUuYWRkU2NlbmUoXCJsZXZlbDFiXCIsIG5ldyBMZXZlbChzaW1wbGVMZXZlbCkpO1xuLy8gZ2FtZS5hZGRTY2VuZShcImxldmVsMWJcIiwgbmV3IExldmVsKGxldmVsMWIpKTtcbmdhbWUuc2V0QW50aWFsaWFzaW5nKGZhbHNlKTtcbmdhbWUuYWRkU2NlbmUoXCJsZXZlbDFiXCIsIG5ldyBMZXZlbChsZXZlbDFiKSk7XG5nYW1lLmdvVG9TY2VuZShcImxldmVsMWJcIik7XG5nYW1lLnN0YXJ0KCk7XG5cblxuY29uc3QgbW92ZVBsYXllckJ5ID0gZnVuY3Rpb24oZHg6IG51bWJlciwgZHk6IG51bWJlcikge1xuICBpZiAoZ2FtZS5jdXJyZW50U2NlbmUgaW5zdGFuY2VvZiBMZXZlbCkge1xuICAgIChnYW1lLmN1cnJlbnRTY2VuZSBhcyBMZXZlbCkucGxheWVyLm1vdmVCeShkeCwgZHkpO1xuICB9XG59O1xuXG5bXCJjbGlja1wiLCBcInRvdWNoc3RhcnRcIl0uZm9yRWFjaChmdW5jdGlvbiAoYWN0aW9uOiBzdHJpbmcpIHtcblxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbnRyb2wtbGVmdFwiKS5hZGRFdmVudExpc3RlbmVyKGFjdGlvbiwgZnVuY3Rpb24oZXZlbnQpe1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgbW92ZVBsYXllckJ5KC0xLCAwKTtcbiAgfSk7XG5cbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb250cm9sLXVwXCIpLmFkZEV2ZW50TGlzdGVuZXIoYWN0aW9uLCBmdW5jdGlvbihldmVudCl7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBtb3ZlUGxheWVyQnkoMCwgLTEpO1xuICB9KTtcblxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbnRyb2wtZG93blwiKS5hZGRFdmVudExpc3RlbmVyKGFjdGlvbiwgZnVuY3Rpb24oZXZlbnQpe1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgbW92ZVBsYXllckJ5KDAsIDEpO1xuICB9KTtcblxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbnRyb2wtcmlnaHRcIikuYWRkRXZlbnRMaXN0ZW5lcihhY3Rpb24sIGZ1bmN0aW9uKGV2ZW50KXtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIG1vdmVQbGF5ZXJCeSgxLCAwKTtcbiAgfSk7XG59KTtcbiJdfQ==
